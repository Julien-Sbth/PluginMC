<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel</title>
</head>
<body>
<h1>Admin Panel</h1>

<form id="createPlayerForm">
  <label for="player_id">Player ID:</label><br>
  <input type="text" id="player_id" name="player_id" required><br>

  <label for="player_name">Player Name:</label><br>
  <input type="text" id="player_name" name="player_name" required><br>

  <label for="entity_type">Entity Type:</label><br>
  <input type="text" id="entity_type" name="entity_type" required><br>

  <label for="score">Score:</label><br>
  <input type="number" id="score" name="score" required><br>

  <label for="coins">Coins:</label><br>
  <input type="number" id="coins" name="coins" required><br>

  <label for="kills">Kills:</label><br>
  <input type="number" id="kills" name="kills" required><br>

  <label for="blocks">Blocks Moved:</label><br>
  <input type="number" id="blocks" name="blocks" required><br>

  <label for="achievements">Achievements:</label><br>
  <input type="number" id="achievements" name="achievements" required><br>

  <label for="itemName">Item Name:</label><br>
  <input type="text" id="itemName" name="item_name" required><br>

  <label for="quantity">Quantity:</label><br>
  <input type="number" id="quantity" name="quantity" required><br>

  <label for="price">Price:</label><br>
  <input type="number" id="price" name="price" required><br>

  <label for="purchase_date">Purchase Date:</label><br>
  <input type="text" id="purchase_date" name="purchase_date" required><br>

  <label for="blockName">Block Name:</label><br>
  <input type="text" id="blockName" name="block_name" required><br>

  <label for="position">Position:</label><br>
  <input type="number" id="position" name="position" required><br>

  <label for="nomItem">Nom Item:</label><br>
  <input type="text" id="nomItem" name="nom_item" required><br>

  <br><br>
  <button type="button" onclick="createPlayer()">Create Player</button>
</form>

<h2>All Players</h2>
<ul id="playerList">
</ul>

<h2>Update Player</h2>
<form id="updatePlayerForm">
  <label for="updateId">Player ID to Update:</label><br>
  <input type="number" id="updateId" name="id" required><br>
  <label for="updateName">New Name:</label><br>
  <input type="text" id="updateName" name="name" required><br>
  <label for="updateScore">New Score:</label><br>
  <input type="number" id="updateScore" name="score" required><br><br>
  <button type="submit" onclick="updatePlayer()">Update Player</button>
</form>

<h2>Delete Player</h2>
<form id="deletePlayerForm">
  <label for="deleteId">Player ID to Delete:</label><br>
  <input type="number" id="deleteId" name="id" required><br><br>
  <button type="submit">Delete Player</button>
</form>

<script>
  function fetchPlayers() {
    const playerList = document.getElementById("playerList");
    if (!playerList) return;

    fetch("/read")
            .then(response => response.json())
            .then(data => {
              playerList.innerHTML = "";

              if (data) {
                data.forEach(player => {
                  const listItem = document.createElement("li");
                  listItem.textContent = `ID: ${player.id}, Name: ${player.name}, Player ID: ${player.player_id}, Player Name: ${player.player_name}, Score: ${player.score}, Coins: ${player.coins}, Kills: ${player.kills}, EntityType: ${player.entityType}, Blocks: ${player.blocks}, Achievements: ${player.achievements}, ItemName: ${player.itemName}, Quantity: ${player.quantity}, Price: ${player.price}, PurchaseDate: ${player.purchaseDate}, BlockName: ${player.blockName}, NomBlocks: ${player.nomBlocks}, Position: ${player.position}, NomItem: ${player.nomItem}`;
                  playerList.appendChild(listItem);
                });
              } else {
                console.error('No player data received.');
              }
            })
            .catch(error => console.error('Error fetching players:', error));
  }

  function createPlayer() {
    const requiredFields = ["player_id", "player_name", "entity_type", "score", "coins", "kills", "blocks", "achievements", "itemName", "quantity", "price", "purchase_date", "blockName", "position", "nomItem"];
    const data = {};

    for (let field of requiredFields) {
      const value = document.getElementById(field).value.trim();
      if (value === "") {
        console.error(`Field '${field}' is required.`);
        return;
      }
      data[field] = value;
    }

    const numericFields = ["score", "coins", "kills", "blocks", "achievements", "quantity", "price", "position"];
    for (let field of numericFields) {
      const value = document.getElementById(field).value.trim();
      if (isNaN(value)) {
        console.error(`Field '${field}' must be a number.`);
        return;
      }
      data[field] = parseInt(value);
    }

    fetch("/create", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(data)
    })
            .then(response => {
              if (response.ok) {
                console.log("Player created successfully");
                fetchPlayers();
                document.getElementById("createPlayerForm").reset();
              } else {
                console.error("Failed to create player:", response.status);
              }
            })
            .catch(error => console.error("Error creating player:", error));
  }

  function updatePlayer() {
    const updateId = document.getElementById("updateId").value;
    const updateName = document.getElementById("updateName").value;
    const updateScore = document.getElementById("updateScore").value;

    const data = {
      id: parseInt(updateId),
      name: updateName,
      score: parseInt(updateScore)
    };

    fetch("/update", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(data)
    })
            .then(response => {
              if (response.ok) {
                fetchPlayers();
                document.getElementById("updatePlayerForm").reset();
              } else {
                console.error('Update player failed:', response.status);
              }
            })
            .catch(error => console.error('Error updating player:', error));
  }

  document.addEventListener("DOMContentLoaded", fetchPlayers);
</script>
</body>
</html>
